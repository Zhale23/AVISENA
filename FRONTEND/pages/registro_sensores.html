<!-- Row 2 -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3 mb-4">
          <div>
            <h4 class="card-title mb-1">Registros de Sensores</h4>
          </div>
          <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-outline-primary btn-sm" onclick="loadContent('sensor_types')"
              data-required-module="sensor_types" data-required-action="ver">
              <i class="fa-solid fa-layer-group"></i>
              <span class="d-none d-sm-inline">Tipos Sensor</span>
            </button>
            <button class="btn btn-outline-primary btn-sm" onclick="loadContent('sensors')"
              data-required-module="sensors" data-required-action="ver">
              <i class="fa-solid fa-satellite-dish"></i>
              <span class="d-none d-sm-inline">Sensores</span>
            </button>
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="refreshRegistros()">
              <i class="fa-solid fa-refresh"></i>
              <span class="d-none d-sm-inline">Actualizar</span>
            </button>
          </div>
        </div>

        <div class="row g-3 mb-4">
          <div class="col-12 col-sm-6 col-md-3">
             <div class="input-group">
              <span class="input-group-text">Fecha inicio</span>
              <input type="date" id="filter-date-from" class="form-control form-control-sm">
            </div>
          </div>

          <div class="col-12 col-sm-6 col-md-3">
           <div class="input-group">
              <span class="input-group-text">Fecha fin</span>
              <input type="date" id="filter-date-to" class="form-control form-control-sm">
            </div>
          </div>
          <div class="col-12 col-sm-6 col-md-3">
            <select class="form-select rounded-end border-secondary shadow-sm bg-white" id="filter-galpon">
              <option value="all">Seleccione un galpón</option>
            </select>
          </div>
          <div class="col-12 col-sm-6 col-md-3">
            <select class="form-select rounded-end border-secondary shadow-sm bg-white" id="filter-sensor">
              <option value="all">Seleccione un sensor</option>
            </select>
          </div>
        </div>

        <div class="d-flex gap-2 mb-4">
          <button type="button" class="btn btn-primary btn-sm" onclick="applyFilters()">
            <i class="fas fa-filter me-1"></i> Filtrar
          </button>
          <button type="button" class="btn btn-secondary btn-sm" onclick="clearFilters()">
            <i class="fas fa-times-circle me-1"></i> Limpiar
          </button>
        </div>

        <div class="table-responsive">
          <table class="table table-striped table-hover table-sm mb-0">
            <thead>
              <tr>
                <th>Sensor</th>
                <th>Galpón</th>
                <th>Valor</th>
                <th>Unidad</th>
                <th>Fecha y Hora</th>
                <th class="text-end">Acciones</th>
              </tr>
            </thead>
            <tbody id="registros-table-body">
            </tbody>
          </table>
        </div>

        <div id="pagination-container" class="d-none mt-3">
          <nav aria-label="Paginación de registros">
            <ul class="pagination justify-content-center mb-0" id="pagination"></ul>
          </nav>
        </div>
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-body">
        <h5 class="card-title mb-4">Análisis de Datos</h5>

        <div class="row g-3 mb-4">
          <div class="col-12 col-md-4">
            <label for="filter-galpon-promedios" class="form-label">Galpón</label>
            <select class="form-select rounded-end border-secondary shadow-sm bg-white" id="filter-galpon-promedios">
              <option value="todos">Seleccione un galpón</option>
            </select>
          </div>
          <div class="col-12 col-md-4">
            <label for="filter-sensor-promedios" class="form-label">Sensor</label>
            <select class="form-select rounded-end border-secondary shadow-sm bg-white" id="filter-sensor-promedios">
              <option value="todos">Seleccione un sensor</option>
            </select>
          </div>
          <div class="col-12 col-md-4 d-flex align-items-end">
            <div class="btn-group w-100" role="group">
              <input type="radio" class="btn-check btn-tipo-promedio" name="tipo-promedio" id="tipo-diario" value="diario" data-tipo="diario" checked>
              <label class="btn btn-outline-primary btn-sm" for="tipo-diario">Diario</label>

              <input type="radio" class="btn-check btn-tipo-promedio" name="tipo-promedio" id="tipo-semanal" value="semanal" data-tipo="semanal">
              <label class="btn btn-outline-primary btn-sm" for="tipo-semanal">Semanal</label>

              <input type="radio" class="btn-check btn-tipo-promedio" name="tipo-promedio" id="tipo-mensual" value="mensual" data-tipo="mensual">
              <label class="btn btn-outline-primary btn-sm" for="tipo-mensual">Mensual</label>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12 col-lg-8">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Gráfico de Promedios</h6>
                <div style="position: relative; height: 350px;">
                  <div id="promedios-empty" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:10;">
                    <div class="text-center w-100 px-3">
                      <i class="fa-solid fa-chart-line fs-1 text-muted mb-3"></i><br>
                      <h6 class="text-muted mb-2">Seleccione un sensor para visualizar datos</h6>
                      <p class="small text-muted mb-0">Puede filtrar por galpón primero para ver solo los sensores de ese galpón</p>
                    </div>
                  </div>
                  <canvas id="promediosChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="card border-light shadow-sm h-100">
              <div class="card-body">
                <h5 class="card-title mb-3">Alertas y Estadísticas</h5>
                
                <!-- Contenedor de Alertas -->
                <div id="alertas-container" class="mb-3">
                  <!-- Las alertas se generarán aquí dinámicamente -->
                  <div class="alert alert-info d-flex align-items-center mb-0">
                    <div class="d-flex align-items-center w-100">
                      <div class="flex-shrink-0">
                        <i class="fa-solid fa-circle-info fs-4 me-3"></i>
                      </div>
                      <div class="flex-grow-1">
                        <h6 class="mb-1">CARGANDO DATOS</h6>
                        <p class="mb-0 small">Analizando lecturas de sensores...</p>
                      </div>
                    </div>
                  </div>
                </div>
                
                <hr class="my-4">
                
                <h6 class="mb-3">Resumen</h6>
                <div class="card bg-light border-0">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-6 mb-3">
                        <div class="small text-muted">Total Registros:</div>
                        <div class="h5 fw-bold" id="total-registros">0</div>
                      </div>
                      <div class="col-6 mb-3">
                        <div class="small text-muted">Sensores Activos:</div>
                        <div class="h5 fw-bold" id="sensores-activos">0</div>
                      </div>
                      <div class="col-12 mb-3">
                        <div class="small text-muted">Valor Máximo:</div>
                        <div class="h6 fw-bold" id="valor-maximo">0.00</div>
                        <small class="text-muted" id="sensor-maximo"></small>
                      </div>
                      <div class="col-12">
                        <div class="small text-muted">Valor Mínimo:</div>
                        <div class="h6 fw-bold" id="valor-minimo">0.00</div>
                        <small class="text-muted" id="sensor-minimo"></small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>